---
title: "Common Vulnerabilities and Exposures Analysis"
author: "Alessandro Zanatta"
output:
  ioslides_presentation: 
    css: styles.css
    transition: slower
    code_folding: hide
---

```{r setup, include=FALSE}
require("knitr")
knitr::opts_chunk$set(echo = TRUE)
opts_knit$set(root.dir = "C:/Users/aless/Documents/Universita/Secondo_anno/secondo_semestre/data_science/CVE_Project")
```

```{r, echo=FALSE, warning=FALSE, include=FALSE}
library(tibble)
library(dplyr)
library(ggplot2)
library(extrafont)

# Load fonts
font_import()
loadfonts(device = "win")
```

```{r echo=FALSE}

# Set working directory
setwd("C:/Users/aless/Documents/Universita/Secondo_anno/secondo_semestre/data_science/CVE_Project")

using_mitre = FALSE

# ================== #
# ===== Import ===== #
# ================== #

# NVD dataset
if(using_mitre){
  all_cve = read.csv("datasets/mitre/allitems.csv")
}

# Kaggle datasets
cve = read.csv("datasets/kaggle/cve.csv")
products = read.csv("datasets/kaggle/products.csv")
vendor_product = read.csv("datasets/kaggle/vendor_product.csv")
vendors = read.csv("datasets/kaggle/vendors.csv")


# Pretty view

# View(all_cve)
# View(cve)
# View(products)
# View(vendor_product)
# View(vendors)


# ================== #
# ====== Tidy ====== #
# ================== #

if(using_mitre){
# We can see that the dataset from MITRE contains a header that is not related to the dataset.
# Column names are also not correct. These are stored in the header we just mentioned.
# We should also note that rows are the CVE codes. Let's make them being the first column instead.

# Delete the first 9 rows
all_cve = all_cve %>%
  slice(10:n())

# Change column names
all_cve = all_cve %>%
  rename("Status" = "CVE.Version.20061101") %>%
  rename("Description" = "X") %>%
  rename("References" = "X.1") %>%
  rename("Phase" = "X.2") %>%
  rename("Votes" = "X.3") %>%
  rename("Comments" = "X.4")

# Make the CVE code a column in the dataset
all_cve = rownames_to_column(all_cve, "Code")

# View(all_cve)
}

# We can also notice that there is a redundant column in the vendor's product dataset. 
# It is basically a duplicate of the row number, so we can simply remove it.

# Remove redundant column
vendor_product = vendor_product %>% select(-X)

# Datasets are now clean and we can start the analysis.
```

## Introduction

1. What are the Common Vulnerabilities and Exposures (CVE)?
1. What is the Common Vulnerability Scoring System (CVSS)?

```{r, echo=FALSE, out.width = '70%', fig.align='center'}
knitr::include_graphics("C:/Users/aless/Documents/Universita/Secondo_anno/secondo_semestre/data_science/CVE_Project/src/img/cvebanner.png")
```

## Common Vulnerabilities and Exposures

**CVE**s is a list of **computer security problems** and threats maintained by MITRE. The list contains both vulnerabilities and exposures. 

Following the MITRE's terminology, these are *different*:

> A **vulnerability** is a weakness in the computational logic (e.g. code) found in software and some hardware components that, when exploited, results in a negative impact to confidentiality, integrity, *or* availability.
>
> An **exposure** is a system configuration issue or a mistake in software that allows access to information or capabilities that can be used by a hacker as a stepping-stone into a system or network.

## Common Vulnerability Scoring System

The **CVSS** is an open framework for communicating the characteristics and severity of software vulnerabilities.

Two common uses of CVSS are calculating the **severity** of vulnerabilities discovered on one's systems. The *National Vulnerability Database* (NVD) provides CVSS scores for almost **all** known vulnerabilities. 

CVSS consists of three metric groups: Base, Temporal, and Environmental. The Base metrics produce a score ranging from 0 to 10, which can then be modified by scoring the Temporal and Environmental metrics.

```{r, echo=FALSE, out.width = '100%', fig.align='center'}
knitr::include_graphics("C:/Users/aless/Documents/Universita/Secondo_anno/secondo_semestre/data_science/CVE_Project/src/img/cvss.png")
```

## Analysis

> How are the CVSS scores distributed?

```{r, echo=FALSE, warning=FALSE}

cve %>%
  mutate(cvss = cut(cvss, breaks=10)) %>%
  group_by(cvss) %>%
  summarise(n=n()) %>%
ggplot(aes(cvss, n, fill=cvss)) +
  geom_bar(position="dodge", stat="identity") +
  theme_minimal() + 
  scale_fill_manual(values=c("#49B063","#84B25C","#A1B459","#CDB654","#F9C74F",
                             "#F9B74E","#F9A64D","#F9844A", "#F96347", "#F94144")) +
  labs(title="Threat Severity Distribution", 
       subtitle="Analyze threat severity using CVSS", 
       x = "Severity (CVSS)", 
       y = "Number of cases") +
  guides(fill = FALSE) + 
  theme(text = element_text(family = "Montserrat Regular"),
        plot.title = element_text(size=20),
        axis.text.x = element_text(size=11), 
        axis.text.y = element_text(size=11),) + 
  scale_x_discrete(breaks=waiver(), labels=c("(0,1]","(1,2]","(2,3]","(3,4]","(4,5]","(5,6]","(6,7]","(7,8]","(8,9]","(9,10]"))

```


## Reference

[Kaggle](https://www.kaggle.com/andrewkronser/cve-common-vulnerabilities-and-exposures/data)

[MITRE](https://cve.mitre.org/data/downloads/index.html)

[National Vulnerability Database](https://nvd.nist.gov)

